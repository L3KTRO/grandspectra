<!-- header.component.html -->
<header id="header">
  <div class="header-item" id="brand">
    <app-grand-spectra-brand/>
  </div>

  <a (click)="toggleSearch()" style="margin-right: 0.25rem; transform: translateY(0.2rem); justify-self: flex-end" id="lupa"
     *ngIf="windowWidth() <= 725">
    <svg height="2.25rem" width="2.25rem" version="1.1" id="Layer_1"
         xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 45" enable-background="new 0 0 50 50"
         xml:space="preserve" fill="#FFF1E0FF" stroke="#FFF1E0FF" stroke-width="1.2"><g id="SVGRepo_bgCarrier" stroke-width="0"></g>
      <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
      <g id="SVGRepo_iconCarrier"> <path fill="#FFF1E0FF"
                                         d="M20.745,32.62c2.883,0,5.606-1.022,7.773-2.881L39.052,40.3c0.195,0.196,0.452,0.294,0.708,0.294 c0.255,0,0.511-0.097,0.706-0.292c0.391-0.39,0.392-1.023,0.002-1.414L29.925,28.319c3.947-4.714,3.717-11.773-0.705-16.205 c-2.264-2.27-5.274-3.52-8.476-3.52s-6.212,1.25-8.476,3.52c-4.671,4.683-4.671,12.304,0,16.987 C14.533,31.37,17.543,32.62,20.745,32.62z M13.685,13.526c1.886-1.891,4.393-2.932,7.06-2.932s5.174,1.041,7.06,2.932 c3.895,3.905,3.895,10.258,0,14.163c-1.886,1.891-4.393,2.932-7.06,2.932s-5.174-1.041-7.06-2.932 C9.791,23.784,9.791,17.431,13.685,13.526z"></path> </g></svg>
  </a>

  <button
    class="burger-menu"
    [class.active]="isMenuOpen()"
    (click)="togglerMenu(isMenuOpen)"
    aria-label="Toggle navigation menu">
        <span class="unread-badge" style="position: absolute; transform: translate(-0.5rem, -0.75rem);"
              *ngIf="this.notificationsHelper.unreadCount() > 0 && !isMenuOpen()">{{ this.notificationsHelper.unreadCount() }}</span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
  </button>

  <!-- Menú de navegación -->
  <nav id="items" [class.mobile-menu-open]="isMenuOpen()">
    <a [routerLink]="'/notifications'" routerLinkActive="active-route" (click)="togglerMenu(isMenuOpen)"
       *ngIf="windowWidth() <= 725">
      <div class="header-item">
      <span class="unread-badge" style="transform: translate(-0.25rem, 0.75rem);"
            *ngIf="this.notificationsHelper.unreadCount() > 0">{{ this.notificationsHelper.unreadCount() }}</span>
        <svg width="25px"
             height="25px" viewBox="0 0 24 24" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
          <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
          <g id="SVGRepo_iconCarrier">
            <path
              d="M15 19.25C15 20.0456 14.6839 20.8087 14.1213 21.3713C13.5587 21.9339 12.7956 22.25 12 22.25C11.2044 22.25 10.4413 21.9339 9.87869 21.3713C9.31608 20.8087 9 20.0456 9 19.25"
              stroke="#FFEFD4FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path
              d="M5.58096 18.25C5.09151 18.1461 4.65878 17.8626 4.36813 17.4553C4.07748 17.048 3.95005 16.5466 4.01098 16.05L5.01098 7.93998C5.2663 6.27263 6.11508 4.75352 7.40121 3.66215C8.68734 2.57077 10.3243 1.98054 12.011 1.99998V1.99998C13.6977 1.98054 15.3346 2.57077 16.6207 3.66215C17.9069 4.75352 18.7557 6.27263 19.011 7.93998L20.011 16.05C20.0723 16.5452 19.9462 17.0454 19.6576 17.4525C19.369 17.8595 18.9386 18.144 18.451 18.25C14.2186 19.2445 9.81332 19.2445 5.58096 18.25V18.25Z"
              stroke="#FFEFD4FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </g>
        </svg>
      </div>
    </a>

    <a routerLink="/hub" routerLinkActive="active-route" (click)="togglerMenu(isMenuOpen)">
      <div class="header-item">
        <span class="header-nav">HUB</span>
      </div>
    </a>

    <a routerLink="/spectators" routerLinkActive="active-route" (click)="togglerMenu(isMenuOpen)">
      <div class="header-item">
        <span class="header-nav">SPECTATORS</span>
      </div>
    </a>

    <a routerLink="/lists" routerLinkActive="active-route" (click)="togglerMenu(isMenuOpen)">
      <div class="header-item">
        <span class="header-nav">LISTS</span>
      </div>
    </a>

    <a routerLink="/spectrai" routerLinkActive="active-route" (click)="togglerMenu(isMenuOpen)">
      <div class="header-item">
        <span class="header-nav" id="spectrai">SPECTR<span id="ai">AI</span></span>
      </div>
    </a>

    <a [routerLink]="me() ? '/spectator/' + me().username : '/login'" routerLinkActive="active-route"
       (click)="togglerMenu(isMenuOpen)"
       *ngIf="windowWidth() <= 725">
      <div class="header-item">
        <span class="header-nav" id="sign">{{ me() ? "PROFILE" : "JOIN US" }}</span>
      </div>
    </a>
  </nav>


  <div id="items" style="align-items: center" *ngIf="windowWidth() >= 725">
    <a (click)="toggleSearch()" style="margin-right: 0.25rem; transform: translateY(0.2rem)" id="lupa">
      <svg height="2.25rem" width="2.25rem" version="1.1" id="Layer_1"
           xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 45" enable-background="new 0 0 50 50"
           xml:space="preserve" fill="#FFF1E0FF" stroke="#FFF1E0FF" stroke-width="1.2"><g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier"> <path fill="#FFF1E0FF"
                                           d="M20.745,32.62c2.883,0,5.606-1.022,7.773-2.881L39.052,40.3c0.195,0.196,0.452,0.294,0.708,0.294 c0.255,0,0.511-0.097,0.706-0.292c0.391-0.39,0.392-1.023,0.002-1.414L29.925,28.319c3.947-4.714,3.717-11.773-0.705-16.205 c-2.264-2.27-5.274-3.52-8.476-3.52s-6.212,1.25-8.476,3.52c-4.671,4.683-4.671,12.304,0,16.987 C14.533,31.37,17.543,32.62,20.745,32.62z M13.685,13.526c1.886-1.891,4.393-2.932,7.06-2.932s5.174,1.041,7.06,2.932 c3.895,3.905,3.895,10.258,0,14.163c-1.886,1.891-4.393,2.932-7.06,2.932s-5.174-1.041-7.06-2.932 C9.791,23.784,9.791,17.431,13.685,13.526z"></path> </g></svg>
    </a>

    <span class="unread-badge"
          *ngIf="this.notificationsHelper.unreadCount() > 0">{{ this.notificationsHelper.unreadCount() }}</span>
    <svg [routerLink]="'/notifications'" (click)="togglerMenu(isMenuOpen)" width="25px"
         height="25px" viewBox="0 0 24 24" fill="none"
         xmlns="http://www.w3.org/2000/svg">
      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
      <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
      <g id="SVGRepo_iconCarrier">
        <path
          d="M15 19.25C15 20.0456 14.6839 20.8087 14.1213 21.3713C13.5587 21.9339 12.7956 22.25 12 22.25C11.2044 22.25 10.4413 21.9339 9.87869 21.3713C9.31608 20.8087 9 20.0456 9 19.25"
          stroke="#FFEFD4FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        <path
          d="M5.58096 18.25C5.09151 18.1461 4.65878 17.8626 4.36813 17.4553C4.07748 17.048 3.95005 16.5466 4.01098 16.05L5.01098 7.93998C5.2663 6.27263 6.11508 4.75352 7.40121 3.66215C8.68734 2.57077 10.3243 1.98054 12.011 1.99998V1.99998C13.6977 1.98054 15.3346 2.57077 16.6207 3.66215C17.9069 4.75352 18.7557 6.27263 19.011 7.93998L20.011 16.05C20.0723 16.5452 19.9462 17.0454 19.6576 17.4525C19.369 17.8595 18.9386 18.144 18.451 18.25C14.2186 19.2445 9.81332 19.2445 5.58096 18.25V18.25Z"
          stroke="#FFEFD4FF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
      </g>
    </svg>
    <a [routerLink]="me() ? '/spectator/' + me().username : '/login'" routerLinkActive="active-route"
       (click)="togglerMenu(isMenuOpen)"
    >
      <div class="header-item">
        <span class="header-nav" id="sign">{{ me() ? "PROFILE" : "JOIN US" }}</span>
      </div>
    </a>
  </div>

  <div class="search-overlay" [class.active]="isSearchOpen()" (click)="toggleSearch()" #overlay>
    <div class="search-container" (click)="$event.stopPropagation()">
      <div class="search-input-wrapper">
        <svg class="search-input-icon" width="20px" height="20px" viewBox="0 0 24 24" fill="none">
          <path
            d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z"
            stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input
          #searchInput
          id="global-search-input"
          type="text"
          placeholder="Search for movies, series, people..."
          [value]="searchQuery()"
          (input)="onSearchInput($event)"
          class="search-input"
        >
      </div>

      <!-- Resultados de búsqueda -->
      <div class="search-results" *ngIf="searchQuery().length >= 2">
        <!-- Loading state -->
        <div class="search-loading" *ngIf="isSearching()">
          <div class="loading-spinner"></div>
          <span>Searching...</span>
        </div>

        <!-- Resultados -->
        <div class="search-results-list" *ngIf="!isSearching() && searchResults().length > 0">
          <div class="search-result-item"
               *ngFor="let result of searchResults()"
               (click)="navigateToResult(result)">
            <div class="result-image">
              <img
                [ngSrc]="getPoster(result.poster || result.still)"
                width="50" height="75"
                [alt]="result.title || result.name"
                loading="lazy">
            </div>
            <div class="result-content">
              <h4 style="font-family: 'GTVCS', serif">{{ result.title || result.name }}</h4>
              <div class="result-metadata">
                <p class="result-type">{{ result._index | titlecase }}</p>
                <p class="result-year" *ngIf="result.release_date || result.first_air_date">
                  {{ (result.release_date || result.first_air_date) | date:'yyyy' }}
                </p>
                <p class="result-year" *ngIf="result.known_for_department">
                  {{ result.known_for_department }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Sin resultados -->
        <div class="no-results" *ngIf="!isSearching() && searchResults().length === 0">
          <p>No results found for "{{ searchQuery() }}"</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay para cerrar el menú en móvil -->
  <div class="menu-overlay" [class.active]="isMenuOpen()" (click)="togglerMenu(isMenuOpen)"></div>
</header>
